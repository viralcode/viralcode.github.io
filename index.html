<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cessna 172M Performance Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #ecf0f1;
            --text-color: #333;
            --input-background: #fff;
            --input-border: #bdc3c7;
        }
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        h1, h2 {
            color: var(--secondary-color);
            text-align: center;
            padding: 20px 0;
            margin: 0;
        }
        h1 {
            background-color: var(--primary-color);
            color: #fff;
        }
        .tab-container {
            display: flex;
            background-color: var(--secondary-color);
        }
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            color: #fff;
            font-size: 16px;
            transition: background-color 0.3s;
            flex: 1;
            text-align: center;
        }
        .tab.active {
            background-color: var(--primary-color);
        }
        .tab-content {
            display: none;
            padding: 20px;
        }
        .tab-content.active {
            display: block;
        }
        .input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .input-group {
            flex: 1 1 200px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .result-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid var(--input-border);
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: var(--primary-color);
            color: #fff;
        }
        .error {
            color: #e74c3c;
            margin-top: 10px;
        }
        .info {
            margin-top: 10px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        #runway-container {
            width: 100%;
            height: 300px;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
        }
        @media (max-width: 600px) {
            .tab-container {
                flex-direction: column;
            }
            .input-group {
                flex: 1 1 100%;
            }
        }
        #wind-canvas {
            width: 100%;
            height: 200px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cessna 172M Performance Calculator</h1>
        
        <div class="tab-container">
            <button class="tab active" onclick="openTab(event, 'performance')">Performance</button>
            <button class="tab" onclick="openTab(event, 'temp-deviation')">Temperature Deviation</button>
            <button class="tab" onclick="openTab(event, 'wind')">Wind Components</button>
        </div>

        <div id="performance" class="tab-content active">
            <h2>Cruise Performance</h2>
            <div class="input-container">
                <div class="input-group">
                    <label for="temperature">Temperature (°C):</label>
                    <input type="number" id="temperature" placeholder="Enter temperature">
                </div>
                <div class="input-group">
                    <label for="altitude">Pressure Altitude (ft):</label>
                    <input type="number" id="altitude" placeholder="Enter altitude">
                </div>
            </div>
            <div id="error" class="error"></div>
            <div id="tempInfo" class="info"></div>
            <div class="result-container">
                <table id="resultTable">
                    <thead>
                        <tr>
                            <th>RPM</th>
                            <th>BHP</th>
                            <th>KTAS</th>
                            <th>GPH</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="temp-deviation" class="tab-content">
            <h2>Temperature Deviation Calculator</h2>
            <div class="input-container">
                <div class="input-group">
                    <label for="dev-temperature">Temperature (°C):</label>
                    <input type="number" id="dev-temperature" placeholder="Enter temperature">
                </div>
                <div class="input-group">
                    <label for="dev-altitude">Pressure Altitude (ft):</label>
                    <input type="number" id="dev-altitude" placeholder="Enter altitude">
                </div>
            </div>
            <div id="dev-result" class="info"></div>
        </div>

        <div id="wind" class="tab-content">
            <h2>Wind Component Calculator</h2>
            <div class="input-container">
                <div class="input-group">
                    <label for="wind-speed">Wind Speed (knots):</label>
                    <input type="number" id="wind-speed" placeholder="Enter wind speed">
                </div>
                <div class="input-group">
                    <label for="wind-direction">Wind Direction (degrees):</label>
                    <input type="number" id="wind-direction" placeholder="Enter wind direction">
                </div>
                <div class="input-group">
                    <label for="runway-heading">Runway Heading (degrees):</label>
                    <input type="number" id="runway-heading" placeholder="Enter runway heading">
                </div>
            </div>
            <div id="wind-result" class="info"></div>
            <canvas id="wind-canvas"></canvas>
        </div>
    </div>

    <script>
        const performanceData = [
            {
                altitude: 2000,
                temperatures: {
                    below: { temp: -5, rpm: [2550, 2500, 2400, 2300, 2200], bhp: [80, 76, 68, 61, 55], ktas: [114, 111, 107, 102, 96], gph: [8.8, 8.3, 7.5, 6.9, 6.4] },
                    standard: { temp: 15, rpm: [2550, 2500, 2400, 2300, 2200], bhp: [75, 71, 64, 58, 52], ktas: [113, 111, 107, 101, 95], gph: [8.2, 7.8, 7.2, 6.7, 6.2] },
                    above: { temp: 35, rpm: [2550, 2500, 2400, 2300, 2200], bhp: [71, 67, 61, 55, 49], ktas: [113, 111, 106, 99, 93], gph: [7.8, 7.5, 6.9, 6.5, 6.1] }
                }
            },
            {
                altitude: 4000,
                temperatures: {
                    below: { temp: -5, rpm: [2600, 2500, 2400, 2300, 2200], bhp: [80, 72, 65, 58, 52], ktas: [116, 111, 107, 101, 95], gph: [8.8, 7.9, 7.3, 6.7, 6.3] },
                    standard: { temp: 15, rpm: [2600, 2500, 2400, 2300, 2200], bhp: [75, 68, 61, 55, 49], ktas: [116, 111, 106, 100, 93], gph: [8.3, 7.5, 6.9, 6.5, 6.1] },
                    above: { temp: 35, rpm: [2600, 2500, 2400, 2300, 2200], bhp: [71, 64, 58, 53, 47], ktas: [116, 110, 104, 98, 92], gph: [7.8, 7.2, 6.7, 6.3, 5.9] }
                }
            },
            {
                altitude: 6000,
                temperatures: {
                    below: { temp: -5, rpm: [2650, 2600, 2500, 2400, 2300, 2200], bhp: [80, 76, 69, 62, 56, 50], ktas: [118, 116, 111, 106, 100, 94], gph: [8.8, 8.3, 7.6, 7.0, 6.5, 6.1] },
                    standard: { temp: 15, rpm: [2650, 2600, 2500, 2400, 2300, 2200], bhp: [75, 71, 65, 59, 53, 47], ktas: [118, 116, 110, 104, 98, 92], gph: [8.2, 7.9, 7.2, 6.7, 6.3, 5.9] },
                    above: { temp: 35, rpm: [2650, 2600, 2500, 2400, 2300, 2200], bhp: [71, 68, 62, 56, 50, 45], ktas: [118, 115, 109, 103, 97, 91], gph: [7.8, 7.5, 7.0, 6.5, 6.1, 5.8] }
                }
            },
            {
                altitude: 8000,
                temperatures: {
                    below: { temp: -5, rpm: [2700, 2600, 2500, 2400, 2300, 2200], bhp: [80, 72, 65, 59, 54, 48], ktas: [120, 116, 111, 105, 99, 93], gph: [8.8, 8.0, 7.3, 6.8, 6.4, 6.0] },
                    standard: { temp: 15, rpm: [2700, 2600, 2500, 2400, 2300, 2200], bhp: [75, 68, 62, 56, 51, 45], ktas: [120, 115, 109, 103, 97, 91], gph: [8.3, 7.5, 7.0, 6.6, 6.2, 5.8] },
                    above: { temp: 35, rpm: [2700, 2600, 2500, 2400, 2300, 2200], bhp: [71, 65, 59, 53, 48, 43], ktas: [120, 114, 108, 101, 96, 90], gph: [7.8, 7.3, 6.8, 6.3, 6.0, 5.7] }
                }
            },
            {
                altitude: 10000,
                temperatures: {
                    below: { temp: -5, rpm: [2700, 2600, 2500, 2400, 2300, 2200], bhp: [76, 69, 63, 57, 51, 46], ktas: [120, 115, 110, 104, 97, 92], gph: [8.4, 7.6, 7.1, 6.6, 6.2, 5.8] },
                    standard: { temp: 15, rpm: [2700, 2600, 2500, 2400, 2300, 2200], bhp: [72, 65, 59, 54, 48, 43], ktas: [120, 114, 108, 102, 96, 90], gph: [7.9, 7.3, 6.8, 6.4, 6.0, 5.7] },
                    above: { temp: 35, rpm: [2700, 2600, 2500, 2400, 2300, 2200], bhp: [68, 62, 56, 51, 46, 41], ktas: [119, 112, 106, 100, 95, 89], gph: [7.6, 7.0, 6.6, 6.2, 5.8, 5.5] }
                }
            },
            {
                altitude: 12000,
                temperatures: {
                    below: { temp: -5, rpm: [2650, 2600, 2500, 2400, 2300, 2200], bhp: [69, 66, 60, 54, 49, 44], ktas: [117, 114, 108, 102, 96, 91], gph: [7.6, 7.4, 6.8, 6.4, 6.0, 5.7] },
                    standard: { temp: 15, rpm: [2650, 2600, 2500, 2400, 2300, 2200], bhp: [65, 62, 57, 51, 46, 41], ktas: [116, 113, 106, 100, 95, 89], gph: [7.3, 7.0, 6.6, 6.2, 5.9, 5.5] },
                    above: { temp: 35, rpm: [2650, 2600, 2500, 2400, 2300, 2200], bhp: [62, 59, 54, 49, 43, 38], ktas: [114, 111, 105, 99, 94, 88], gph: [7.0, 6.8, 6.4, 6.0, 5.7, 5.3] }
                }
            }
        ];

        function interpolate(x, x1, x2, y1, y2) {
            return y1 + (x - x1) * (y2 - y1) / (x2 - x1);
        }

        function round(value, decimals = 0) {
            const factor = Math.pow(10, decimals);
            return Math.round(value * factor) / factor;
        }

        function calculatePerformance() {
            const temperature = parseFloat(document.getElementById('temperature').value);
            const altitude = parseFloat(document.getElementById('altitude').value);
            const errorElement = document.getElementById('error');
            const tempInfoElement = document.getElementById('tempInfo');
            const tableBody = document.querySelector('#resultTable tbody');

            errorElement.textContent = '';
            tempInfoElement.textContent = '';
            tableBody.innerHTML = '';

            if (isNaN(temperature) || isNaN(altitude)) {
                errorElement.textContent = 'Please enter valid temperature and altitude values.';
                return;
            }

            // Find the two closest altitude data points
            const sortedAltitudes = performanceData.map(d => d.altitude).sort((a, b) => Math.abs(a - altitude) - Math.abs(b - altitude));
            const closestAlt1 = sortedAltitudes[0];
            const closestAlt2 = sortedAltitudes[1];

            const data1 = performanceData.find(d => d.altitude === closestAlt1);
            const data2 = performanceData.find(d => d.altitude === closestAlt2);

            // Interpolate between altitudes
            const altInterpolationFactor = (altitude - closestAlt1) / (closestAlt2 - closestAlt1);

            // Determine temperature category and interpolation factor
            let tempCategory1, tempCategory2, tempInterpolationFactor;

            if (temperature <= -5) {
                tempCategory1 = 'below';
                tempCategory2 = 'below';
                tempInterpolationFactor = 0;
            } else if (temperature >= 35) {
                tempCategory1 = 'above';
                tempCategory2 = 'above';
                tempInterpolationFactor = 1;
            } else if (temperature <= 15) {
                tempCategory1 = 'below';
                tempCategory2 = 'standard';
                tempInterpolationFactor = (temperature + 5) / 20;
            } else {
                tempCategory1 = 'standard';
                tempCategory2 = 'above';
                tempInterpolationFactor = (temperature - 15) / 20;
            }

            // Display temperature information
            const standardTemp = 15;
            const tempDiff = round(temperature - standardTemp);
            tempInfoElement.textContent = `Temperature is ${Math.abs(tempDiff)}°C ${tempDiff >= 0 ? 'above' : 'below'} standard (${standardTemp}°C)`;

            // Interpolate performance data
            const interpolatedData = data1.temperatures[tempCategory1].rpm.map((rpm, index) => {
                const interpolateValue = (key) => {
                    const value1 = interpolate(
                        temperature,
                        data1.temperatures[tempCategory1].temp,
                        data1.temperatures[tempCategory2].temp,
                        data1.temperatures[tempCategory1][key][index],
                        data1.temperatures[tempCategory2][key][index]
                    );
                    const value2 = interpolate(
                        temperature,
                        data2.temperatures[tempCategory1].temp,
                        data2.temperatures[tempCategory2].temp,
                        data2.temperatures[tempCategory1][key][index],
                        data2.temperatures[tempCategory2][key][index]
                    );
                    return interpolate(altitude, closestAlt1, closestAlt2, value1, value2);
                };

                return {
                    rpm,
                    bhp: round(interpolateValue('bhp')),
                    ktas: round(interpolateValue('ktas')),
                    gph: round(interpolateValue('gph'), 1)
                };
            });

            // Populate the table with interpolated data
            interpolatedData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.rpm}</td>
                    <td>${row.bhp}</td>
                    <td>${row.ktas}</td>
                    <td>${row.gph}</td>
                `;
                tableBody.appendChild(tr);
            });
        }

        function calculateTempDeviation() {
            const temperature = parseFloat(document.getElementById('dev-temperature').value);
            const altitude = parseFloat(document.getElementById('dev-altitude').value);
            const resultElement = document.getElementById('dev-result');

            if (isNaN(temperature) || isNaN(altitude)) {
                resultElement.textContent = 'Please enter valid temperature and altitude values.';
                return;
            }

            const standardTemp = 15 - altitude / 1000 * 2;
            const deviation = temperature - standardTemp;
            resultElement.textContent = `Temperature is ${Math.abs(round(deviation))}°C ${deviation >= 0 ? 'above' : 'below'} standard (${round(standardTemp)}°C)`;
        }

        let scene, camera, renderer, runway, windArrow;

        function initRunwayScene() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('runway-container').appendChild(renderer.domElement);

            // Create runway
            const runwayGeometry = new THREE.PlaneGeometry(20, 100);
            const runwayMaterial = new THREE.MeshBasicMaterial({ color: 0x333333 });
            runway = new THREE.Mesh(runwayGeometry, runwayMaterial);
            runway.rotation.x = -Math.PI / 2;
            scene.add(runway);

            // Create wind arrow
            const arrowGeometry = new THREE.ConeGeometry(1, 5, 32);
            const arrowMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            windArrow = new THREE.Mesh(arrowGeometry, arrowMaterial);
            windArrow.position.y = 10;
            scene.add(windArrow);

            camera.position.set(0, 50, 50);
            camera.lookAt(scene.position);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function updateWindVisualization(windSpeed, windDirection, runwayHeading) {
            const angle = (windDirection - runwayHeading) * Math.PI / 180;
            windArrow.rotation.y = angle;
            windArrow.scale.y = Math.min(windSpeed / 10, 5);  // Scale arrow based on wind speed
        }

        function calculateWindComponents() {
            const windSpeed = parseFloat(document.getElementById('wind-speed').value);
            const windDirection = parseFloat(document.getElementById('wind-direction').value);
            const runwayHeading = parseFloat(document.getElementById('runway-heading').value);
            const resultElement = document.getElementById('wind-result');

            if (isNaN(windSpeed) || isNaN(windDirection) || isNaN(runwayHeading)) {
                resultElement.textContent = 'Please enter valid wind speed, direction, and runway heading.';
                return;
            }

            const angle = (windDirection - runwayHeading) * Math.PI / 180;
            const headwind = round(windSpeed * Math.cos(angle), 1);
            const crosswind = round(windSpeed * Math.sin(angle), 1);

            resultElement.textContent = `Headwind: ${Math.abs(headwind)} knots ${headwind >= 0 ? 'headwind' : 'tailwind'}, Crosswind: ${Math.abs(crosswind)} knots ${crosswind >= 0 ? 'from right' : 'from left'}`;

            updateWindVisualization(windSpeed, windDirection, runwayHeading);
        }


        function drawWindVisualization(windSpeed, windDirection, runwayHeading) {
            const canvas = document.getElementById('wind-canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // Clear canvas
            ctx.clearRect(0, 0, width, height);

            // Draw runway
            ctx.save();
            ctx.translate(width / 2, height / 2);
            ctx.rotate(runwayHeading * Math.PI / 180);
            ctx.fillStyle = '#333';
            ctx.fillRect(-width / 4, -height / 20, width / 2, height / 10);
            ctx.restore();

            // Draw wind arrow
            ctx.save();
            ctx.translate(width / 2, height / 2);
            ctx.rotate((windDirection - 90) * Math.PI / 180);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(windSpeed * 2, 0);
            ctx.lineTo(windSpeed * 2 - 10, -5);
            ctx.lineTo(windSpeed * 2 - 10, 5);
            ctx.closePath();
            ctx.fillStyle = 'red';
            ctx.fill();
            ctx.restore();

            // Draw compass
            ctx.beginPath();
            ctx.arc(width / 2, height / 2, 5, 0, 2 * Math.PI);
            ctx.fillStyle = 'black';
            ctx.fill();

            // Draw labels
            ctx.fillStyle = 'black';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`Runway: ${runwayHeading}°`, width / 2, height - 10);
            ctx.fillText(`Wind: ${windDirection}° at ${windSpeed} kts`, width / 2, 20);
        }

        function calculateWindComponents() {
            const windSpeed = parseFloat(document.getElementById('wind-speed').value);
            const windDirection = parseFloat(document.getElementById('wind-direction').value);
            const runwayHeading = parseFloat(document.getElementById('runway-heading').value);
            const resultElement = document.getElementById('wind-result');

            if (isNaN(windSpeed) || isNaN(windDirection) || isNaN(runwayHeading)) {
                resultElement.textContent = 'Please enter valid wind speed, direction, and runway heading.';
                return;
            }

            const angle = (windDirection - runwayHeading) * Math.PI / 180;
            const headwind = round(windSpeed * Math.cos(angle), 1);
            const crosswind = round(windSpeed * Math.sin(angle), 1);

            resultElement.textContent = `Headwind: ${Math.abs(headwind)} knots ${headwind >= 0 ? 'headwind' : 'tailwind'}, Crosswind: ${Math.abs(crosswind)} knots ${crosswind >= 0 ? 'from right' : 'from left'}`;

            drawWindVisualization(windSpeed, windDirection, runwayHeading);
        }


        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }

            const tabs = document.getElementsByClassName("tab");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }

            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");

           if (tabName === 'wind') {
                const canvas = document.getElementById('wind-canvas');
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                calculateWindComponents();
            }
        }

        document.getElementById('temperature').addEventListener('input', calculatePerformance);
        document.getElementById('altitude').addEventListener('input', calculatePerformance);
        document.getElementById('dev-temperature').addEventListener('input', calculateTempDeviation);
        document.getElementById('dev-altitude').addEventListener('input', calculateTempDeviation);
        document.getElementById('wind-speed').addEventListener('input', calculateWindComponents);
        document.getElementById('wind-direction').addEventListener('input', calculateWindComponents);
        document.getElementById('runway-heading').addEventListener('input', calculateWindComponents);

        window.addEventListener('resize', function() {
            if (renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        window.addEventListener('resize', function() {
            const canvas = document.getElementById('wind-canvas');
            if (canvas) {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                calculateWindComponents();
            }
        });
    </script>
</body>
</html>